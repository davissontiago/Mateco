{% extends 'base.html' %}

{% block title %}Cat√°logo de Produtos{% endblock %}

{% block head %}
<style>
    .container-produtos { max-width: 900px; margin: 0 auto; width: 100%; box-sizing: border-box; padding-bottom: 50px; }

    /* Cabe√ßalho */
    .header-container { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px; }
    .header-container h1 { margin: 0; color: {{ empresa_ativa.cor_primaria|default:'#00838f' }}; }
    .btn-novo { background-color: #27ae60; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; font-weight: bold; display: inline-flex; align-items: center; gap: 5px; border: none; }
    .btn-novo:hover { background-color: #219150; }
    
    /* Busca */
    .search-box { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); align-items: center; flex-wrap: wrap; }
    .search-input { flex: 2; padding: 10px; border: 1px solid #ccc; border-radius: 5px; height: 40px; box-sizing: border-box; min-width: 200px; }
    .filter-select { flex: 1; padding: 0 10px; border: 1px solid #ccc; border-radius: 5px; height: 40px; box-sizing: border-box; min-width: 150px; background-color: white; }
    .btn-buscar { background-color: {{ empresa_ativa.cor_primaria|default:'#00838f' }}; color: white; border: none; padding: 0 20px; border-radius: 5px; cursor: pointer; font-weight: bold; height: 40px; }
    .btn-limpar { color: #666; text-decoration: none; padding: 0 10px; font-weight: bold; font-size: 0.9em; }

    /* Tabela Desktop */
    table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #eee; vertical-align: middle; }
    th { background-color: {{ empresa_ativa.cor_primaria|default:'#00838f' }}; color: white; font-size: 0.9em; text-transform: uppercase; }
    tr:hover { background-color: #f8f9fa; }

    /* Status */
    .preco { color: #27ae60; font-weight: bold; white-space: nowrap; }
    .estoque-baixo { color: #e67e22; font-weight: bold; background: #fdf2e9; padding: 2px 6px; border-radius: 4px; font-size: 0.9em; }
    .estoque-zerado { color: #c0392b; font-weight: bold; background: #fadbd8; padding: 2px 6px; border-radius: 4px; font-size: 0.9em; }
    .estoque-ok { color: #2980b9; background: #ebf5fb; padding: 2px 6px; border-radius: 4px; font-size: 0.9em; font-weight: bold; }

    /* A√ß√µes */
    /* --- A√á√ïES (CORRE√á√ÉO DE TAMANHO) --- */
    .acoes-container { 
        display: flex; 
        gap: 8px; 
        width: 100%; /* O container ocupa tudo */
    }

    /* For√ßa tanto o Link quanto o Formul√°rio a dividirem o espa√ßo igualmente */
    .acoes-container > a, 
    .acoes-container > form {
        flex: 1;
        display: flex; /* Garante que o filho preencha a altura */
    }

    .btn-acao { 
        flex: 1; /* O bot√£o estica para preencher o pai */
        padding: 8px 8px; /* Padding vertical igual */
        border-radius: 4px; 
        text-decoration: none; 
        font-weight: bold; 
        font-size: 0.9em; 
        border: none; /* Remove borda padr√£o do button */
        cursor: pointer; 
        color: white; 
        
        /* Centraliza o texto/√≠cone perfeitamente */
        display: flex;
        align-items: center;
        justify-content: center;
        
        /* Garante que padding n√£o aumente o tamanho total */
        box-sizing: border-box; 
        line-height: 1.2; /* Normaliza a altura da linha */
        height: 36px; /* Altura fixa para garantir igualdade */
    }

    .btn-editar { background-color: #f39c12; }
    .btn-excluir { background-color: #e74c3c; }

    /* --- MOBILE --- */
    @media (max-width: 768px) {
        .header-container { justify-content: center; text-align: center; }
        .btn-novo { width: 100%; justify-content: center; }
        .search-box { flex-direction: column; align-items: stretch; }
        .search-input, .filter-select, .btn-buscar { width: 100%; flex: auto; }
        
        thead { display: none; }
        table, tbody, th, td, tr { display: block; }
        
        tr { 
            margin-bottom: 15px; 
            border: 1px solid #e0e0e0; 
            border-radius: 8px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.05); 
            background: white; 
        }
        
        td { 
            padding: 12px 15px; 
            text-align: right; 
            border-bottom: 1px solid #f0f0f0; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        
        td::before { 
            content: attr(data-label); 
            font-weight: bold; 
            color: #555; 
            text-transform: uppercase; 
            font-size: 0.75em; 
            text-align: left; 
        }
        
        td:last-child { 
            border-bottom: none; 
            justify-content: center; 
            padding: 15px; 
        }
        
        /* No mobile, mantemos a l√≥gica do container flex√≠vel */
        .acoes-container { width: 100%; }
        .btn-acao { width: 100%; margin: 0px 0px 0px 10px;  padding: 1px 1px;}
    }
</style>
{% endblock %}

{% block content %}
<div class="container-produtos">

    {% if messages %}
        {% for message in messages %}
            <div style="padding:15px; background:#d4edda; color:#155724; border-radius:5px; margin-bottom:20px;">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}
    
    <div class="header-container">
        <h1>Cat√°logo de Produtos</h1>
        <a href="{% url 'criar_produto' %}" class="btn-novo">+ Novo Produto</a>
    </div>

    <form method="get" class="search-box">
        <input type="text" name="q" class="search-input" placeholder="Buscar por nome ou c√≥digo..." value="{{ termo_busca|default:'' }}">
        <select name="filtro_estoque" class="filter-select">
            <option value="">Todos os Estoques</option>
            <option value="positivo" {% if filtro_estoque == 'positivo' %}selected{% endif %}>Com Estoque (> 0)</option>
            <option value="baixo" {% if filtro_estoque == 'baixo' %}selected{% endif %}>Estoque Baixo (1-5)</option>
            <option value="zerado" {% if filtro_estoque == 'zerado' %}selected{% endif %}>Sem Estoque (0)</option>
        </select>
        <button type="submit" class="btn-buscar">üîç Buscar</button>
        {% if termo_busca or filtro_estoque %}
            <a href="{% url 'listar_produtos' %}" class="btn-limpar">Limpar</a>
        {% endif %}
    </form>

    {% if produtos %}
        <table>
            <thead>
                <tr>
                    <th>C√≥d.</th>
                    <th>Descri√ß√£o</th>
                    <th>NCM</th>
                    <th>Pre√ßo</th>
                    <th>Estoque</th>
                    <th style="text-align: center;">A√ß√µes</th>
                </tr>
            </thead>
            <tbody>
                {% for prod in produtos %}
                <tr>
                    <td data-label="C√≥d.">{{ prod.codigo }}</td>
                    <td data-label="Descri√ß√£o"><strong>{{ prod.nome }}</strong></td>
                    <td data-label="NCM">{{ prod.ncm }}</td>
                    <td data-label="Pre√ßo" class="preco">R$ {{ prod.preco }}</td>
                    <td data-label="Estoque">
                        {% if prod.estoque_atual <= 5 and prod.estoque_atual > 0 %}
                            <span class="estoque-baixo"> {{ prod.estoque_atual }}</span>
                        {% elif prod.estoque_atual <= 0 %}
                            <span class="estoque-zerado"> {{ prod.estoque_atual }}</span>
                        {% else %}
                            <span class="estoque-ok">{{ prod.estoque_atual }}</span>
                        {% endif %}
                    </td>
                    <td data-label="A√ß√µes">
                        <div class="acoes-container">
                            <a href="{% url 'editar_produto' prod.id %}" class="btn-acao btn-editar">Editar</a>
                            <form action="{% url 'deletar_produto' prod.id %}" method="POST" style="display:inline; flex: 1;" onsubmit="return confirm('Tem certeza que deseja excluir {{ prod.nome }}?');">
                                {% csrf_token %}
                                <button type="submit" class="btn-acao btn-excluir" style="width: 100%;">Excluir</button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
        <div style="text-align: center; margin-top: 20px; color: #666; font-size: 0.9em;">
            Exibindo {{ produtos.count }} produtos.
        </div>
    {% else %}
        <div style="text-align: center; padding: 40px; color: #7f8c8d; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
            <h3>Nenhum produto encontrado.</h3>
            <p>Tente mudar os filtros ou adicione novos itens.</p>
            <br>
            <a href="{% url 'listar_produtos' %}" class="btn-buscar" style="display:inline-block; width:auto; text-decoration: none;">Ver Todos</a>
        </div>
    {% endif %}
</div>
{% endblock %}