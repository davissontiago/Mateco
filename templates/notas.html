{% extends 'base.html' %}

{% block title %}Hist√≥rico de Notas - Mateco{% endblock %}

{% block head %}
<style>
    /* Container centralizado */
    .container-notas { 
        max-width: 800px; 
        margin: 0 auto; 
        padding-bottom: 50px;
    }

    h1 { 
        color: {{ empresa_ativa.cor_primaria|default:'#00838f' }}; 
        text-align: center; 
        margin-bottom: 30px; 
    }

    /* --- ESTILO PADR√ÉO DA TABELA (DESKTOP) --- */
    table { 
        width: 100%; 
        border-collapse: collapse; 
        background: white; 
        border-radius: 10px; 
        overflow: hidden; 
        box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
    }

    th, td { 
        padding: 15px; 
        text-align: left; 
        border-bottom: 1px solid #eee; 
    }

    th { 
        background-color: {{ empresa_ativa.cor_primaria|default:'#00838f' }}; 
        color: white; 
        font-weight: bold; 
        text-transform: uppercase;
        font-size: 0.85em;
    }

    tr:hover { 
        background-color: #f8f9fa; 
    }

    /* Tags de Status */
    .status { 
        padding: 5px 12px; 
        border-radius: 20px; 
        font-size: 0.85em; 
        font-weight: bold; 
        text-transform: uppercase; 
        background-color: #d4edda; 
        color: #155724; 
    }
    
    .status.cancelada {
        background-color: #f8d7da;
        color: #721c24;
    }

    /* Bot√£o de Visualiza√ß√£o */
    .btn-ver { 
        background-color: {{ empresa_ativa.cor_secundaria|default:'#546e7a' }}; 
        color: white; 
        padding: 8px 15px; 
        text-decoration: none; 
        border-radius: 5px; 
        font-size: 0.9em; 
        font-weight: bold; 
        transition: background 0.3s;
        display: inline-block; /* Garante que padding funcione bem */
    }

    .btn-ver:hover { 
        background-color: #b03e0e; 
    }

    .empty-state { 
        text-align: center; 
        padding: 40px; 
        color: #7f8c8d; 
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    }

    /* --- OTIMIZA√á√ÉO PARA CELULAR (CARD VIEW) --- */
    @media (max-width: 768px) {
        /* Esconde o cabe√ßalho da tabela pois os labels estar√£o dentro dos cards */
        thead {
            display: none;
        }

        table, tbody, th, td, tr {
            display: block; /* Transforma elementos de tabela em blocos */
        }

        /* O estilo do "Card" (cada linha vira um cart√£o) */
        tr {
            margin-bottom: 20px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        /* Estilo das c√©lulas dentro do card */
        td {
            padding: 12px 15px;
            text-align: right; /* Conte√∫do alinhado √† direita */
            border-bottom: 1px solid #f0f0f0;
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* A "m√°gica": insere o t√≠tulo da coluna antes do conte√∫do */
        td::before {
            content: attr(data-label); /* Pega o valor do atributo data-label */
            font-weight: bold;
            color: #555;
            text-transform: uppercase;
            font-size: 0.8em;
            text-align: left;
        }

        /* Remove a borda do √∫ltimo item (bot√£o) */
        td:last-child {
            border-bottom: none;
            justify-content: center; /* Centraliza o bot√£o */
            padding-top: 15px;
            padding-bottom: 15px;
        }
        
        /* Esconde o label do bot√£o para ele ficar centralizado limpo */
        td:last-child::before {
            display: none;
        }

        /* Ajuste do bot√£o para ocupar largura total no mobile se quiser */
        .btn-ver {
            width: 100%;
            text-align: center;
            box-sizing: border-box;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-notas">
    <h1>Hist√≥rico de Emiss√µes</h1>

    {% if notas %}
        <table>
            <thead>
                <tr>
                    <th>N√∫mero</th>
                    <th>Data</th>
                    <th>Valor</th>
                    <th>Pagamento</th> <th>Status</th>
                    <th>A√ß√£o</th>
                </tr>
            </thead>
            <tbody>
                {% for nota in notas %}
                <tr>
                    <td data-label="N√∫mero"><strong>{{ nota.numero }}</strong></td>
                    
                    <td data-label="Data">{{ nota.data_emissao|date:"d/m/Y H:i" }}</td>
                    
                    <td data-label="Valor" style="color: {{ empresa_ativa.cor_primaria|default:'#00838f' }}; font-weight: bold;">
                        R$ {{ nota.valor_total }}
                    </td>

                    <td data-label="Pagamento">
                        {{ nota.get_forma_pagamento_display|default:"Dinheiro" }}
                    </td>
                    
                    <td data-label="Status">
                        <span class="status {% if nota.status == 'CANCELADA' %}cancelada{% endif %}">
                            {{ nota.status }}
                        </span>
                    </td>
                    
                    <td data-label="A√ß√£o">
                        <a href="{% url 'imprimir_nota' nota.id %}" target="_blank" class="btn-ver">
                            üìÑ PDF
                        </a>
                        
                        {% if nota.status != 'CANCELADA' %}
                            {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div class="empty-state">
            <h3>Nenhuma nota emitida ainda.</h3>
            <p>Comece a operar agora mesmo!</p>
            <br>
            <a href="{% url 'emitir' %}" class="btn-ver">Emitir Nova Nota</a>
        </div>
    {% endif %}
</div>
{% endblock %}