{% extends 'base.html' %}
{% load static %} 

{% block title %}
    Frente de Caixa - Mateco
{% endblock %}

{% block head %}
    <link rel="stylesheet" href="{% static 'css/emitir.css' %}" />
{% endblock %}

{% block content %}
<div class="container-pdv">
    <h1 style="{{ empresa_ativa.cor_primaria|default:'#00838f' }};">Frente de Caixa</h1>

    <div class="abas-container">
        <button class="btn-aba ativo" onclick="mudarModo('manual')" id="btn-manual">
            Busca Manual ‚úçÔ∏è
        </button>
        <button class="btn-aba" onclick="mudarModo('valor')" id="btn-valor">
          Carrinho Inteligente üí°
        </button>
    </div>

    <div id="painel-manual" class="area-busca">
        <input type="text" id="buscaInput" class="input-busca" 
               placeholder="üîç Buscar produto..." autocomplete="off" />
        <div id="listaSugestoes" class="sugestoes-lista"></div>
    </div>

    <div id="painel-valor" class="area-busca hidden">
        <div class="input-valor-group">
            <input type="number" id="valor-alvo" class="input-busca" 
                   placeholder="Ex: 50.00" step="0.01" />
            <button onclick="gerarCarrinhoInteligente()" class="btn-completar btn-adicionar" 
                    style="background-color: {{ empresa_ativa.cor_secundaria|default:'#546e7a' }}; height: 50px; margin-left: 10px;">
                ‚ö°Gerar
            </button>
        </div>
        <p style="text-align: center; font-size: 0.85em; color: #666; margin-top: 5px;">
            O sistema escolher√° produtos at√© atingir este valor.
        </p>
    </div>

    <div class="carrinho" id="carrinhoVisual">
        <div style="text-align: center; color: #bbb; padding: 30px 0;">Seu carrinho est√° vazio üõí</div>
    </div>

    <div class="secao-inferior">
        <div class="total-display" id="totalDisplay" style="color: {{ empresa_ativa.cor_secundaria|default:'#546e7a' }};">R$ 0,00</div>

        <div class="area-pagamento" style="margin-bottom: 15px;">
            <label for="forma_pagamento" style="font-weight: bold; display: block; margin-bottom: 5px; color: {{ empresa_ativa.cor_primaria|default:'#00838f' }};">
                Forma de Pagamento:
            </label>
            <select id="forma_pagamento" class="input-busca" style="width: 100%; height: 45px;">
                <option value="01">01 - Dinheiro</option>
                <option value="03">03 - Cart√£o de Cr√©dito</option>
                <option value="04">04 - Cart√£o de D√©bito</option>
                <option value="17">17 - PIX</option>
            </select>
        </div>

        <button class="btn-emitir" id="btnEmitir" onclick="emitirNota()" 
                style="background-color: {{ empresa_ativa.cor_secundaria|default:'#546e7a' }};" disabled>
            EMITIR NOTA
        </button>
        
        <button class="btn-limpar" onclick="limparCarrinho()">Limpar Carrinho ‚ùå</button>

        <div id="status"></div>
    </div>

    <dialog id="modalQuantidade">
        <div class="modal-titulo" style="color: #00838f;">Quantas unidades?</div>
        <div id="nomeProdModal" class="modal-prod-nome" style="color: {{ empresa_ativa.cor_secundaria|default:'#546e7a' }};">...</div>

        <input type="number" id="qtdInputModal" class="input-qtd" value="1" min="1" 
               inputmode="numeric" style="border-color: #00838f;" />

        <div class="modal-btn-area">
            <button class="btn-cancelar" onclick="fecharModalQtd()">Cancelar</button>
            <button class="btn-confirmar" onclick="confirmarAdicaoManual()" 
                    style="background-color: #00838f;">ADICIONAR</button>
        </div>
    </dialog>

    <dialog id="modalConfirmacao">
        <div class="modal-titulo">Confirmar Emiss√£o?</div>
        <div style="font-size: 1.5rem; font-weight: bold; color: {{ empresa_ativa.cor_secundaria|default:'#546e7a' }}; margin: 20px 0;" 
             id="valorConfirmacaoModal">R$ 0,00</div>
        <div id="pagamentoConfirmacaoModal" style="color: #00838f; margin-bottom: 20px; font-weight: bold;"></div>

        <div class="modal-btn-area">
            <button class="btn-cancelar" onclick="document.getElementById('modalConfirmacao').close()">VOLTAR</button>
            <button class="btn-confirmar" id="btnConfirmarFinal" style="background: #27ae60;">CONFIRMAR</button>
        </div>
    </dialog>

    {% csrf_token %}
</div>
{% endblock %}

{% block scripts %}
    <script src="{% static 'js/emitir.js' %}"></script>
{% endblock %}